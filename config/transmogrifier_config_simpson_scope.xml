<?xml version="1.0"?>

<transmogrifierConfiguration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                     xsi:noNamespaceSchemaLocation="transmogrifier_config.xsd">

    <global minimumVersion="4.0.1"/>

    <project name="Simpson: IHC Optimizing from Nighthawk" taskName="collector">

        <inputFileFilter patternString=".*\.xml">
            <xmlPropertyFile targetGroupPath="data"
                             relativeTargetPath="row"
                             relativeTargetNamePath="path">

                <targetProperty relativePath="capture_date"/>
                <targetProperty relativePath="sage_line"/>
                <targetProperty relativePath="effector"/>
                <targetProperty relativePath="gender"/>
                <targetProperty relativePath="age"/>
                <targetProperty relativePath="mounting_protocol"/>
                <targetProperty relativePath="channels"/>
                <targetProperty relativePath="objective"/>
                <targetProperty relativePath="voxel_size_x"/>
                <targetProperty relativePath="voxel_size_y"/>
                <targetProperty relativePath="voxel_size_z"/>
                <targetProperty relativePath="dimension_x"/>
                <targetProperty relativePath="dimension_y"/>
                <targetProperty relativePath="dimension_z"/>
            </xmlPropertyFile>
        </inputFileFilter>

        <inputFileSorter sortAlgorithm="LNumber"/>

        <plugins>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.ImageSequencePlugin">
                <property name="db.config.key" value="sage" />
                <property name="sample_number" value="urn:lsid:janelia.org:simpson_ihc_optimizing:sample_number" />
            </rowListener>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.ImageDataPlugin">
                <property name="db.config.key" value="sage"/>
                <property name="exclude.host.name" value="true"/>
                <property name="keep.existing.data" value="true"/>
                <property name="lab" value="$STATIC:simpson"/>
                <property name="family" value="$STATIC:simpson_ihc_optimizing"/>
                <property name="relativePathDepth" value="3"/>
                <property name="line" value="sage_line"/>
                <property name="capture_date" value="capture_date"/>
                <property name="data_set" value="data_set"/>
                <property name="slide_code" value="ihc_sample_${sample_number}"/>
                <property name="tile" value="tile"/>
                <property name="area" value="area"/>
                <property name="channel_spec" value="channel_spec"/>
                <!--<property name="effector" value="effector"/>-->
                <!--<property name="gender" value="gender"/>-->
                <!--<property name="age" value="age"/>-->
                <!--<property name="mounting_protocol" value="mounting_protocol"/>-->
                <property name="channels" value="channels"/>
                <property name="objective" value="objective"/>
                <property name="voxel_size_x" value="voxel_size_x"/>
                <property name="voxel_size_y" value="voxel_size_y"/>
                <property name="voxel_size_z" value="voxel_size_z"/>
                <property name="dimension_x" value="dimension_x"/>
                <property name="dimension_y" value="dimension_y"/>
                <property name="dimension_z" value="dimension_z"/>
                <property name="base_path" value="$STATIC:/groups/simpson/MicroscopeData/Immunohistochemistry_Optimizing/"/>
            </rowListener>

        </plugins>

        <dataFields>
            <pluginData displayName="sample_number" format="%06d"/>
            <date displayName="capture_date" required="true" datePattern="yyyy-MM-dd HH:mm:ss">
                <targetPropertyDefault propertyName="capture_date"/>
            </date>
            <text displayName="data_set" required="true"><staticDefault value="knappj_ihc_optimizing"/></text>
            <text displayName="tile" required="true"><staticDefault value="brain"/></text>
            <text displayName="area" required="true"><staticDefault value="Brain"/></text>
            <text displayName="channel_spec" required="true"><staticDefault value="rs"/></text>
            <webServiceList displayName="sage_line" required="true"
                            valueCreationPath="*/line"
                            relativeActualValuePath="name"
                            relativeValueDisplayNamePath="name"
                            serviceUrl="http://sage.int.janelia.org/sage-ws/lines/forMultipleLabs.janelia-sage?lab=fly&amp;lab=flylight&amp;lab=rubin&amp;lab=jayaraman&amp;lab=simpson&amp;lab=leet&amp;lab=zlatic"
                            autoComplete="true">
                <targetPropertyDefault propertyName="sage_line"/>
            </webServiceList>
            <!--<text displayName="effector" required="false"><targetPropertyDefault propertyName="effector"/></text>-->
            <!--<text displayName="gender" required="false"><targetPropertyDefault propertyName="gender"/></text>-->
            <!--<text displayName="age" required="false"><targetPropertyDefault propertyName="age"/></text>-->
            <!--<text displayName="mounting_protocol" required="false"><targetPropertyDefault propertyName="mounting_protocol"/></text>-->
            <text displayName="channels" required="true"><targetPropertyDefault propertyName="channels"/></text>
            <text displayName="objective" required="true"><targetPropertyDefault propertyName="objective"/></text>
            <text displayName="voxel_size_x" required="true"><targetPropertyDefault propertyName="voxel_size_x"/></text>
            <text displayName="voxel_size_y" required="true"><targetPropertyDefault propertyName="voxel_size_y"/></text>
            <text displayName="voxel_size_z" required="true"><targetPropertyDefault propertyName="voxel_size_z"/></text>
            <text displayName="dimension_x" required="true"><targetPropertyDefault propertyName="dimension_x"/></text>
            <text displayName="dimension_y" required="true"><targetPropertyDefault propertyName="dimension_y"/></text>
            <text displayName="dimension_z" required="true"><targetPropertyDefault propertyName="dimension_z"/></text>
        </dataFields>

    </project>

    <project name="Simpson: Sensory Descending Alignment" taskName="collector" default="true">

        <inputFileFilter patternString=".+\.lsm" />

        <inputFileSorter sortAlgorithm="Number"
                         patternString="\d{8}_(.*AD)_DPX_(\d\d)X_L(\d\d)\.lsm"
                         patternGroupIndexes="1,3,2" />

        <plugins>

            <rowUpdater className="org.janelia.it.ims.tmog.plugin.dataFile.ZeissLsmDataPlugin">
                <property name="Channel Specification" value="Recording #1 Number of Channels$MAP:1=r|2=sr|3=srr" />
            </rowUpdater>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.ImageDataPlugin">
                <property name="db.config.key" value="sage"/>
                <property name="exclude.host.name" value="true"/>
                <property name="lab" value="$STATIC:simpson"/>
                <property name="family" value="$STATIC:simpson_descending"/>
                <property name="relativePathDepth" value="4"/> <!-- Steffi/Grooming/ConfocalData/Alignment -->
                <property name="line" value="Line"/>
                <property name="data_set" value="$STATIC:simpsonlab_sensory_descending_alignment"/>
                <property name="slide_code" value="JHS_SDA_${Sample Date}_${Sample Number}${Sample Extension}"/>
                <property name="tile" value="Tile"/>
                <property name="area" value="Tile$MAP:MAP_DEFAULT=Brain|abdominal=VNC|mesothorasic=VNC|metathorasic=VNC|prothorasic=VNC|ventral_nerve_cord=VNC|vnc_verify=VNC-Verify"/>
                <property name="channel_spec" value="Channel Specification"/>
                <property name="tissue_orientation" value="Tissue Orientation"/>
            </rowListener>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.SageLoaderPlugin">
                <property name="serviceUrl" value="http://jacs-data2.int.janelia.org:8180/rest-v1/sageLoader"/>
                <property name="owner" value="system"/>
                <property name="config" value="/groups/scicomp/informatics/data/flylightflip_light_imagery-config.xml"/>
                <property name="grammar" value="/usr/local/pipeline/grammar/simpson_descending.gra"/>
                <property name="lab" value="simpson"/>
                <property name="debug" value="true"/>
                <property name="testUrl" value="http://jacs-data2.int.janelia.org:8180/rest-v1/task/1593757153544372426/currentStatus"/>
                <property name="relativePathDepth" value="4"/> <!-- Steffi/Grooming/ConfocalData/Alignment -->
            </rowListener>

        </plugins>

        <dataFields>

            <date displayName="Sample Date" required="true"
                  markedForTask="false"
                  sharedForAllSessionFiles="true"
                  datePattern="yyyyMMdd">
            </date>

            <text displayName="Sample Number" required="true"
                  markedForTask="false"
                  pattern="L\d\d">
                <sourceFileDefault pattern=".*X_(L\d\d).*" />
            </text>

            <text displayName="Sample Extension" required="false"
                  markedForTask="false"/>

            <webServiceList displayName="Line" required="true"
                            markedForTask="false"
                            valueCreationPath="*/line"
                            relativeActualValuePath="name"
                            relativeValueDisplayNamePath="name"
                            serviceUrl="http://sage.int.janelia.org/sage-ws/lines/forMultipleLabs.janelia-sage?lab=rubin&amp;lab=simpson"
                            autoComplete="true">
            </webServiceList>

            <cvTermList displayName="Tile" required="true"
                        serviceUrl="http://sage.int.janelia.org/sage-ws/cvs/fly_light_adult_tiles"
                        autoComplete="true"
                        markedForTask="false">
                <sourceFileMappedDefault pattern=".*_DPX_(\d\d)X_.*">
                    <mappedValue from="20" to="brain"/>
                    <mappedValue from="63" to="central"/>
                </sourceFileMappedDefault>
            </cvTermList>

            <text displayName="Channel Specification" required="true"
                  markedForTask="false"
                  pattern="s*rs*">
            </text>

            <cvTermList displayName="Tissue Orientation" required="true"
                        autoComplete="true"
                        markedForTask="false"
                        serviceUrl="http://sage.int.janelia.org/sage-ws/cvs/tissue_orientation"
                        displayNamePrefixedForValues="false">
                <staticDefault value="face_up"/>
            </cvTermList>

        </dataFields>

    </project>

</transmogrifierConfiguration>