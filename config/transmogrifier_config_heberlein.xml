<?xml version="1.0"?>

<transmogrifierConfiguration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                     xsi:noNamespaceSchemaLocation="transmogrifier_config.xsd">

    <global minimumVersion="2.9.6" frameSizePercentage="95"/>

    <project name="Heberlein - Central Brain (UAHC*)" default="true">

        <inputFileSorter sortAlgorithm="Number"
                         patternString=".*_(L)(\d++)(\.lsm)"/>

        <outputDirectory basePath="[\\dm11.janelia.priv|/groups/heberlein]/heberleinlab/image/heberlein_central_brain/confocalStacks"
                         derivedFromEarliestModifiedFile="true"/>

        <plugins>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.ImageSequencePlugin">
                <property name="db.config.key" value="sage" />
                <property name="image_number" value="urn:lsid:janelia.org:heberlein_central_brain:image_number" />
            </rowListener>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.ImageDataPlugin">
                <property name="db.config.key" value="sage"/>
                <property name="lab" value="$STATIC:heberlein"/>
                <property name="family" value="$STATIC:heberlein_central_brain"/>
                <property name="line" value="Line"/>
                <property name="effector" value="Effector"/>
                <property name="slide_code" value="${Mount Date}_${Slide Number}_${Slide Location}"/>
                <property name="tile" value="Tile"/>
                <property name="condition" value="Condition"/>
                <property name="data_set" value="Data Set"/>
                <property name="channel_spec" value="Channel Specification"/>
                <property name="microscope_filename"/>
                <property name="base_path" value="$STATIC:/groups/heberlein/heberleinlab/image/heberlein_central_brain/confocalStacks/"/>
            </rowListener>

            <!--
                  The companion file listener (for log files) should be the
                  last defined plug-in to ensure that log files are only
                  copied if the source lsm processing succeeds.
            -->
            <rowListener className="org.janelia.it.ims.tmog.plugin.CompanionFileRowListener" >
                <property name="sourceSuffix" value=".lsm"/>
                <property name="companionSuffix" value="_log.csv"/>
                <property name="deleteAfterCopy" value="true"/>
            </rowListener>

        </plugins>

        <dataFields>

            <separator value="UAHC_"/>
            <runTime datePattern="yyyyMMddHHmmssSSS" />
            <separator value="_"/>
            <pluginData displayName="image_number"/>
            <separator value=".lsm"/>

            <!--
             These values are collected for storage but are not
             included as components of the file name (markedForTask="false").
             -->

            <webServiceList displayName="Line" required="true"
                            markedForTask="false"
                            valueCreationPath="*/line"
                            relativeActualValuePath="name"
                            relativeValueDisplayNamePath="name"
                            serviceUrl="http://sage.int.janelia.org/sage-ws/lines/forMultipleLabs.janelia-sage?lab=heberlein"
                            autoComplete="true">
            </webServiceList>

            <!-- filtered list from http://sage.int.janelia.org/sage-ws/cvs/effector -->
            <validValueList displayName="Effector" required="true"
                            autoComplete="true"
                            markedForTask="false">
                <validValue displayName="57C10Lwt_attp8_3stop1" value="57C10Lwt_attp8_3stop1"/>
                <validValue displayName="w1118(5905); +; pJFRC12-10XUAS-IVS-myr::GFP (V) $" value="UAS_IVS_myr_3_0009"/>
            </validValueList>

            <date displayName="Mount Date" required="true"
                  datePattern="yyyyMMdd"
                  markedForTask="false">
                <sourceFileDateDefault pattern=".*_(\d{8})_.*"
                                       fromDatePattern="yyyyMMdd"
                                       toDatePattern="yyyyMMdd"/>
            </date>

            <text displayName="Slide Number" required="true"
                  pattern="[A-Za-z]*\d+"
                  markedForTask="false">
            </text>

            <text displayName="Slide Location" required="true"
                  pattern="[A-Z]\d\d?"
                  convertToUpperCase="true"
                  markedForTask="false">
                <sourceFileSlideLocationDefault pattern="(?:^|.*_)B(\d+)_.*"
                                                numberOfSlideColumns="6"/>
            </text>

            <validValueList displayName="Tile" required="true"
                            autoComplete="true"
                            markedForTask="false">
                <validValue displayName="Ventral" value="ventral"/>
                <validValue displayName="Left Dorsal" value="left_dorsal"/>
                <validValue displayName="Right Dorsal" value="right_dorsal"/>
            </validValueList>


            <validValueList displayName="Condition" required="true"
                            autoComplete="true"
                            markedForTask="false">
                <sourceFileDefault pattern=".*_([^_]+)_R\d.*"/>
                <validValue value="extracted"/>
                <validValue value="delineates"/>
                <validValue value="mated"/>
                <validValue value="rejected"/>
            </validValueList>

            <webServiceList displayName="Data Set" required="true"
                            markedForTask="false"
                            valueCreationPath="*/dataSet"
                            relativeActualValuePath="dataSetIdentifier"
                            relativeValueDisplayNamePath="dataSetIdentifier"
                            serviceUrl="http://jacs.int.janelia.org:8180/rest-v1/dataSet?user=heberleinlab&amp;includeOnlySageSync=true"
                            autoComplete="true">
            </webServiceList>

            <text displayName="Channel Specification" required="true"
                  markedForTask="false"
                  pattern="s*rs*">
            </text>

        </dataFields>

    </project>

    <project name="Heberlein - fix SAGE data" taskName="collector">

        <plugins>

            <rowUpdater className="org.janelia.it.ims.tmog.plugin.dataFile.ZeissLsmDataPlugin">
                <property name="plugin-scale" value="0" />
                <property name="Channels" value="Recording #1 Number of Channels" />
            </rowUpdater>

            <rowUpdater className="org.janelia.it.ims.tmog.plugin.dataFile.ZeissLsmDataPlugin">
                <property name="plugin-scale" value="2" />
                <property name="Voxel Size X" value="VoxelSizeX" />
                <property name="Voxel Size Y" value="VoxelSizeY" />
                <property name="Voxel Size Z" value="VoxelSizeZ" />
            </rowUpdater>

            <rowValidator className="org.janelia.it.ims.tmog.plugin.imagedb.ImagePathExistsValidator">
                <property name="db.config.key" value="sage"/>
            </rowValidator>

            <rowListener className="org.janelia.it.ims.tmog.plugin.imagedb.ImageDataPlugin">
                <property name="db.config.key" value="sage"/>
                <property name="lab" value="$STATIC:heberlein"/>
                <property name="family" value="$STATIC:heberlein_central_brain"/>
                <property name="exclude.host.name" value="true"/>
                <property name="channels" value="Channels"/>
                <property name="voxel_size_x" value="Voxel Size X"/>
                <property name="voxel_size_y" value="Voxel Size Y"/>
                <property name="voxel_size_z" value="Voxel Size Z"/>
                <property name="slide_code" value="Slide Code"/>
                <property name="base_path" value="$STATIC:/groups/heberlein/heberleinlab/image/heberlein_central_brain/confocalStacks/"/>
            </rowListener>

        </plugins>

        <dataFields>

            <text displayName="Slide Code" required="true"
                  pattern="\d{8}_\d+_[A-Z]\d+"
                  markedForTask="false">
                <pluginDefault className="org.janelia.it.ims.tmog.plugin.imagedb.SageImageDataDefaultValue">
                    <property name="family" value="heberlein_central_brain"/>
                    <property name="image_property" value="slide_code"/>
                </pluginDefault>
            </text>

            <number displayName="Channels" required="true"
                    markedForTask="false" />
            <decimal displayName="Voxel Size X" required="true"
                     markedForTask="false" />
            <decimal displayName="Voxel Size Y" required="true"
                     markedForTask="false" />
            <decimal displayName="Voxel Size Z" required="true"
                     markedForTask="false" />

        </dataFields>

    </project>

</transmogrifierConfiguration>